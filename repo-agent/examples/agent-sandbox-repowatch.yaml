apiVersion: review.gemini.google.com/v1alpha1
kind: RepoWatch
metadata:
  name: agent-sandbox
spec:
  repoURL: https://github.com/kubernetes-sigs/agent-sandbox
  githubSecretName: github-pat
  review:
    maxActiveSandboxes: 2
    devcontainerConfigRef: go-devcontainer-json
  issueHandlers:
  - name: triage
    maxActiveSandboxes: 2
    devcontainerConfigRef: go-devcontainer-json
    labels:
      - "needs-triage"
    gemini:
      prompt: |
        You are a helpful assistant that triages GitHub issues for a Kubernetes-related open source project.
        Your task is to categorize incoming issues based on their content and assign appropriate labels.
        Analyze the issue title and body to determine the most relevant category from the following options:
        1. bug: Issues that describe unexpected behavior, errors, or malfunctions in the software.
        2. feature: Suggestions for new features, enhancements, or improvements to existing functionality.
        2. cleanup: Suggestions for cleaning up code, removing deprecated features, or improving code quality.
        3. document: Issues related to documentation errors, omissions, or requests for clarification.
        4. support: Questions or requests for help regarding the use of the software.
        5. other: Any issue that does not fit into the above categories.

        Start the response with "/kind <Category>" where <Category> is one of bug , feature , document, support, cleanup or other
        In the next line, provide a concise explanation of your reasoning for the assigned category.
 
        Issue Title: "{{.Title}}"
        Issue Body: "{{.Body}}"
        HTML URL: "{{.HTMLURL}}"
  - name: fixes
    maxActiveSandboxes: 1
    devcontainerConfigRef: go-devcontainer-json
    pushEnabled: true
    labels:
      - "kind/cleanup"
      - "kind/bug"
      - "kind/feature"
    gemini:
      prompt: |
        You are an expert software engineer specializing in debugging and fixing issues in Kubernetes-related open source projects.
        This repo you are working on Agent Sandbox is a kubernetes sigs project to help run sandboxes for agent or user use.
        The sandbox crd creates a pod, pvc (conditionally) and a service.
        The extensions folder contains CRDs and controllers that provide additional features such as Templates and Claims.
        Your task is to analyze the issue and provide a detailed plan to fix the reported problems.
        The repo code is available locally for reference. Please look at the code as well as git history to understand the context of the issue. 
        Review the issue title and body to understand the problem, then outline the steps needed to resolve it, including any code changes, tests, or documentation updates required.
        Then go ahead and make those changes in the local folder.
        Dont forget to add any relevant tests to verify your fix.
        At the end run relevant tests to make sure the fix works.
        Commit the changes with a meaningful commit message.
        Do not attempt to push any changes.

        If needed look at the comments on the issue linked here for more context: {{.HTMLURL}}

        Issue Title: "{{.Title}}"
        Issue Body: "{{.Body}}"
        HTML URL: "{{.HTMLURL}}"